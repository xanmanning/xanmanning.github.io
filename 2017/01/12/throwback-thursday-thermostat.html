<!DOCTYPE html>
<html lang="en-gb">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.66.0" />

    
    
    

<title>Throwback Thursday: Thermostat â€¢ Xan Manning</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Throwback Thursday: Thermostat"/>
<meta name="twitter:description" content="I&rsquo;ve decided to occasionally look back on some of the weird and wonderful projects I have had over the last couple of years to remind myself of the journey I have taken.
Today I am writing about a project I created to fix a problem with a misbehaving version of our CRM software (to remain nameless).
Backstory So this tale begins when I worked as first line technical support at an internet service provider (ISP)."/>

<meta property="og:title" content="Throwback Thursday: Thermostat" />
<meta property="og:description" content="I&rsquo;ve decided to occasionally look back on some of the weird and wonderful projects I have had over the last couple of years to remind myself of the journey I have taken.
Today I am writing about a project I created to fix a problem with a misbehaving version of our CRM software (to remain nameless).
Backstory So this tale begins when I worked as first line technical support at an internet service provider (ISP)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xanmanning.co.uk/2017/01/12/throwback-thursday-thermostat.html" />
<meta property="article:published_time" content="2017-01-12T20:32:00+00:00" />
<meta property="article:modified_time" content="2017-01-12T20:32:00+00:00" /><meta property="og:site_name" content="Xan Manning" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">



<link rel="stylesheet" href="/css/custom-highlights.css">





<link rel="stylesheet" href="/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css" integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">


<link rel="stylesheet" href="/css/custom.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://xanmanning.co.uk/">Xan Manning</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://xanmanning.co.uk/images/avatar.png" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         Ramblings of a Linux geek and cloud fanatic dabbling in DevOps! 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Xan Manning</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/">
						<span>Blog</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/xanmanning" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/xanmanning" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/xanmanning" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	<a href="mailto:xan%20at%20manning%20dot%20io" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2020 Xan Manning
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Throwback Thursday: Thermostat</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jan 12, 2017
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 2 min read
</div>


  </header>
  
  
  <div class="post">
    <p>I&rsquo;ve decided to occasionally look back on some of the weird and wonderful projects I have had over the last couple of years to remind myself of the journey I have taken.</p>
<p>Today I am writing about a project I created to fix a problem with a misbehaving version of our CRM software (to remain nameless).</p>
<h2 id="backstory">Backstory</h2>
<p>So this tale begins when I worked as first line technical support at an internet service provider (ISP). Our ticketing system had been migrated over to our new CRM, however the version we were using had a small flaw. It caused high load to one CPU core when open, with most of the tech support desk using solo core processors. This made life <em>unbearable</em>, especially as we had to do a lot of work on JavaScript heavy webpages outside of the CRM software.</p>
<p><img src="/images/2017/01/100pc_Usage.PNG" alt="100% CPU Usage" /></p>
<h2 id="solution">Solution</h2>
<p>Our workflow was interrupted by the slow and unresponsive ticketing system, there was no ETA for an update but work had to continue. In a little under a week I decided to write a small Visual C# application that would throttle the CRM process to allow the computer to do other work. We obviously only wanted this to happen when not working in the CRM software, so we had two distinct behaviors:</p>
<p><strong>When CRM is not focused (idle)</strong></p>
<ul>
<li>Set&rsquo;s CPU affinity to core0. (does this once, multi-core machines only)</li>
<li>Deprioritise CPU Threads. (sets priority to LOW, allowing other processes to use CPU)</li>
<li>Throttles CPU usage. (when throttling is enabled)</li>
<li>Monitors CRM to make sure is responsive. (when Throttling)</li>
</ul>
<p><strong>When CRM is focused</strong></p>
<ul>
<li>Prioritize CPU threads.</li>
<li>Monitor CRM to make sure responsive. (when Throttling)</li>
</ul>
<h2 id="the-result">The Result</h2>
<p>When active, Thermostat would take average load down from 100% to ~38%.</p>
<p><img src="/images/2017/01/Throttled_Usage.PNG" alt="Better CPU usage" /></p>
<h2 id="side-effects-of-throttling">Side effects of throttling</h2>
<p>Throttling was done by using the standard Windows <code>SuspendThread()</code> method in kernel32.dll. One of the side effects of throttling the process was that occasionally the application would become completely unresponsive.</p>
<p>To overcome this, a built in health monitor within the application would attempt to send several calls to <code>ResumeThread()</code> to try bring it online. To keep the user informed of the changes to the state of the CRM system, Thermostat would notify the user via a Balloon Tip.</p>
<p><strong>Recovered CRM process:</strong></p>
<p><img src="/images/2017/01/Warning.PNG" alt="CRM Recovered" /></p>
<p><strong>Dead CRM Process:</strong></p>
<p><img src="/images/2017/01/flatline.PNG" alt="CRM Flatlined" /></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/2017/01/08/chmod-0777-when-permissions-go-bad-and-using-the-sticky-bit.html" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Chmod 0777; when permissions go bad and using the Sticky bit!</span>
    </a>
    
    
    <a href="/2017/01/19/saltstack-lab-in-vagrant.html" class="navigation-next">
      <span class="navigation-tittle">SaltStack Lab in Vagrant</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
