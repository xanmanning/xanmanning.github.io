<!DOCTYPE html>
<html lang="en-gb">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.66.0" />

    
    
    

<title>Quick security tip! Docker containers and ufw. â€¢ Xan Manning</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Quick security tip! Docker containers and ufw."/>
<meta name="twitter:description" content="I recently discovered that the Docker daemon &lsquo;out of the box&rsquo; (as it where) will run with the option --iptables=true.
Why is this important? - Well, for on your own development environment perhaps it isn&rsquo;t so important. You can just get on with running your containers and access them over the network as expected.
If you are a bit more security conscious, perhaps because you are running on a production server, you will have firewall rules of some sort."/>

<meta property="og:title" content="Quick security tip! Docker containers and ufw." />
<meta property="og:description" content="I recently discovered that the Docker daemon &lsquo;out of the box&rsquo; (as it where) will run with the option --iptables=true.
Why is this important? - Well, for on your own development environment perhaps it isn&rsquo;t so important. You can just get on with running your containers and access them over the network as expected.
If you are a bit more security conscious, perhaps because you are running on a production server, you will have firewall rules of some sort." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xanmanning.co.uk/2016/07/28/quick-security-tip-docker-containers-and-ufw.html" />
<meta property="article:published_time" content="2016-07-28T19:59:16+00:00" />
<meta property="article:modified_time" content="2016-07-28T19:59:16+00:00" /><meta property="og:site_name" content="Xan Manning" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">



<link rel="stylesheet" href="/css/custom-highlights.css">





<link rel="stylesheet" href="/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css" integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">


<link rel="stylesheet" href="/css/custom.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://xanmanning.co.uk/">Xan Manning</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://xanmanning.co.uk/images/avatar.png" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         Ramblings of a Linux geek and cloud fanatic dabbling in DevOps! 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Xan Manning</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/">
						<span>Blog</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/xanmanning" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/xanmanning" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/xanmanning" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	<a href="mailto:xan%20at%20manning%20dot%20io" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2020 Xan Manning
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Quick security tip! Docker containers and ufw.</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jul 28, 2016
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 2 min read
</div>


  </header>
  
  
  <div class="post">
    <p>I recently discovered that the Docker daemon &lsquo;out of the box&rsquo; (as it where) will run with the option <code>--iptables=true</code>.</p>
<p><em>Why is this important?</em> - Well, for on your own development environment perhaps it isn&rsquo;t so important. You can just get on with running your containers and access them over the network as expected.</p>
<p>If you are a bit more security conscious, perhaps because you are running on a production server, you will have firewall rules of some sort. <code>iptables</code> users may have spotted this but <code>ufw</code> users will potentially miss this: Docker is allowed to make changes to iptables to make networking easier. The reason why ufw users may miss this happening is that the rules for Docker do not appear in the list of rules.</p>
<p>Perhaps you want Docker managing <code>iptables</code>, this is your decision, but if you are running a selection of microservices behind an <code>nginx</code> load balancer/reverse proxy then you might not want this.</p>
<p><em>How do we fix this?</em> - Luckily it isn&rsquo;t that hard to change the behavior.</p>
<h2 id="systemd-distros">systemd Distros</h2>
<p>Debian 8 for example, edit: /etc/systemd/system/multi-user.target.wants/docker.service</p>
<pre><code>vim /etc/systemd/system/multi-user.target.wants/docker.service
</code></pre><p>You are looking for the following line:</p>
<pre><code>ExecStart=/usr/bin/docker daemon -H fd://
</code></pre><p>Change it to:</p>
<pre><code>ExecStart=/usr/bin/docker daemon -H fd:// --iptables=false
</code></pre><p>Restart your Docker daemon</p>
<pre><code>systemctl restart docker
</code></pre><h2 id="non-systemd-systems">non-systemd Systems</h2>
<p>Ubuntu 14.04 for example.</p>
<p>Edit /etc/default/docker</p>
<pre><code>vim /etc/default/docker
</code></pre><p>Change the following line:</p>
<pre><code>DOCKER_OPTS=&quot;--dns 8.8.8.8 --dns 8.8.4.4&quot;
</code></pre><p>To:</p>
<pre><code>DOCKER_OPTS=&quot;--dns 8.8.8.8 --dns 8.8.4.4 --iptables=false&quot;
</code></pre><p>Restart your Docker daemon</p>
<pre><code>service docker restart
</code></pre>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/2016/07/27/making-deb-packages-using-docker.html" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Making .deb packages using Docker</span>
    </a>
    
    
    <a href="/2016/08/19/re-architecting-a-global-data-object-store.html" class="navigation-next">
      <span class="navigation-tittle">Re-architecting a Global Data Object store</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
